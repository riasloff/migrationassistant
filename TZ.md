# Техническое задание: Разработка утилиты для управления миграциями базы данных с веб-интерфейсом

Проект должен включать несколько аспектов:

* Работа с базой данных для хранения и управления миграциями.
* Создание и использование структур и интерфейсов для управления миграциями.
* Конкурентное выполнение миграций с использованием goroutines и каналов.
* Создание HTTP-сервера для управления миграциями через веб-интерфейс.
* Работа с конфигурационными файлами для настройки соединения с базой данных.
* Логирование и обработка ошибок.
## Основные требования
1. Подключение к базе данных:

* Подключение к базе данных должно быть настроено через конфигурационный файл (например, config.json).
* Утилита должна поддерживать работу с базами данных PostgreSQL и MySQL (в зависимости от конфигурации).
* Использовать пакет database/sql и драйверы для PostgreSQL и MySQL.
2. Управление миграциями:

* Миграии должны храниться в виде SQL-файлов в отдельной директории (migrations).
* Каждая миграция состоит из двух файлов: up (применение миграции) и down (откат миграции).
* Миграции должны быть пронумерованы и упорядочены (например, 001_init.up.sql и 001_init.down.sql).
3. Хранение состояния миграций:

* В базе данных должна быть создана таблица для хранения информации о примененных миграциях (например, migrations).
* Таблица должна содержать информацию о номере миграции, имени файла и дате применения.
4. HTTP-сервер:

* Сервер должен запускаться на порту, указанном в конфигурационном файле.
* Должны быть реализованы следующие эндпоинты:
    * `GET /migrations` - отображает список всех миграций и их статус (применены или нет).
    * `POST /migrations/apply/{id}` - применяет миграцию с указанным ID.
    * `POST /migrations/rollback/{id}` - откатывает миграцию с указанным ID.
5. Работа с миграциями:

* Применение и откат миграций должны выполняться в отдельных goroutines для предотвращения блокировок.
* Должны быть использованы каналы для передачи информации о статусе выполнения миграции между goroutine и основным процессом.
6. Логирование и обработка ошибок:

* Все действия должны логироваться (например, в файл или консоль).
* Ошибки при подключении к базе данных, выполнении миграций и других операциях должны обрабатываться и логироваться.
7. Конфигурационный файл:

* Пример конфигурационного файла (config.json):
```json
Copy code
{
  "db": {
    "driver": "postgres",
    "dsn": "user=postgres password=mysecretpassword dbname=mydb sslmode=disable"
  },
  "server": {
    "port": "8080"
  }
}
```
* Должны быть поддержаны параметры для настройки подключения к базе данных (DSN) и порта веб-сервера.
## Задачи по разработке
1. Создать конфигурационный файл и реализовать его чтение.

* Прочитать конфигурацию из файла config.json.
* Подключиться к базе данных на основе настроек из файла.
2. Реализовать систему хранения миграций и их состояния.

* Создать структуру для работы с миграциями (например, Migration).
* Реализовать функции для применения и отката миграций.
* Создать таблицу migrations в базе данных для хранения информации о примененных миграциях.
3. Реализовать HTTP-сервер для управления миграциями.

* Настроить сервер для работы на порту, указанном в конфигурации.
* Реализовать эндпоинты для просмотра, применения и отката миграций.
4. Добавить логирование и обработку ошибок.

* Реализовать функции для логирования действий и ошибок.
* Убедиться, что ошибки при выполнении миграций корректно обрабатываются и логируются.
5. Тестирование и отладка.

* Тестировать подключение к базе данных, выполнение миграций и работу веб-сервера.
* Убедиться, что утилита корректно работает с базами данных PostgreSQL и MySQL.
## Демонстрация работы
Для наглядной демонстрации работы утилиты:

1. Запуск утилиты:

* Запустите сервер, используя команду go run main.go.
* Проверьте доступность веб-интерфейса по адресу `http://localhost:8080/migrations`.
2. Просмотр миграций:

* Перейдите по адресу `http://localhost:8080/migrations`, чтобы увидеть список всех доступных миграций и их статус.
3. Применение миграции:

* Выполните запрос `POST /migrations/apply/001`, чтобы применить первую миграцию.
* Убедитесь, что миграция была успешно применена, и запись о ней появилась в базе данных.
4. Откат миграции:

* Выполните запрос `POST /migrations/rollback/001`, чтобы откатить первую миграцию.
* Убедитесь, что миграция была успешно откатана, и запись о ней была удалена из базы данных.
## Дополнительные требования (по желанию)
1. Добавить поддержку нескольких баз данных одновременно.

* Реализовать возможность работы с несколькими базами данных, переключение между ними через параметры конфигурации.
2. Реализовать систему шаблонов для создания новых миграций.

* Добавить возможность создания новых миграций с использованием шаблонов SQL.
3. Реализовать систему уведомлений.

* Добавить отправку уведомлений (например, через email) при успешном или неудачном выполнении миграций.
Этот проект охватывает основные аспекты программирования на Go, включая работу с базами данных, конкуренцию, сетевое программирование и управление конфигурациями. Успешная реализация данного задания поможет закрепить знания, полученные на предыдущих уроках, и значительно улучшить навыки разработки на Go.
